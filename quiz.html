<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Statistics Quiz</title>

  <!-- MathJax for LaTeX rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="glass-bg"></div>
  <div class="noise-layer"></div>
  <div class="particle-layer" id="particle-layer"></div>
  <div id="screenshot-blocker"></div>

  <!-- Welcome overlay (student/admin selection) -->
  <div class="overlay" id="welcome-overlay">
    <div class="quiz-container" id="welcome-screen" role="dialog" aria-modal="true">
      <div class="quiz-header">
        <h1>Welcome to Statistics Quiz</h1>
        <span class="score small-muted">Choose your role to continue</span>
      </div>

      <div class="role-row">
        <button class="role-btn" id="student-btn">
          <div class="role-icon">üéì</div>
          <div><div style="font-weight:700;">Student</div><div class="small-note">Enter name & roll before starting</div></div>
        </button>

        <button class="role-btn" id="admin-btn">
          <div class="role-icon">üõ°Ô∏è</div>
          <div><div style="font-weight:700;">Admin</div><div class="small-note">Login to edit questions & settings</div></div>
        </button>
      </div>

      <div id="student-form" class="welcome-form">
        <div class="field">
          <label class="small-muted">Full name</label>
          <input id="student-name" placeholder="e.g. Vicky " />
        </div>
        <div class="field">
          <label class="small-muted">Roll number</label>
          <input id="student-roll" placeholder="e.g. 23AI006" />
        </div>

        <div class="field">
          <label class="small-muted">Number of Questions</label>
          <div id="student-questions-count" class="small-muted">(Will be set by Admin)</div>
        </div>

        <div class="field">
          <label class="small-muted">Quiz Duration</label>
          <div id="student-quiz-duration" class="small-muted">(Will be set by Admin)</div>
        </div>

        <div class="welcome-actions">
          <button class="btn" id="start-quiz-btn">Start Quiz</button>
          <button class="btn neutral" id="student-cancel">Back</button>
        </div>
      </div>

      <div id="admin-login" class="welcome-form" style="display:none;">
        <div class="field">
          <label class="small-muted">Admin ID</label>
          <input id="admin-id" placeholder="Admin ID" />
        </div>
        <div class="field">
          <label class="small-muted">Password</label>
          <input id="admin-pass" placeholder="Password" type="password" />
        </div>
        <div class="welcome-actions">
          <button class="btn" id="admin-login-btn">Login</button>
          <button class="btn neutral" id="admin-cancel">Back</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz container -->
  <div class="quiz-container" id="quiz-container" style="display:none;">
    <div class="timer" id="timer">00:00</div>
    <div class="quiz-header">
      <h1>Statistics Quiz</h1>
      <span class="score">Score: <span id="score">0</span> / <span id="total-placeholder">0</span></span>
    </div>
    <div id="question-container">
      <p class="question" id="question">Loading...</p>
      <div id="options"></div>
    </div>
    <div class="quiz-footer">
      <span id="question-count">1 of 10 Questions</span>
      <button class="btn" id="next-btn" disabled>Next</button>
    </div>
  </div>

  <!-- Result screen -->
  <div class="result-screen" id="result-screen" style="display:none;">
    <div class="result-glow" aria-hidden></div>
    <div class="result-card">
      <h2 id="result-heading">Congratulations!</h2>
      <p class="result-message" id="result-message"></p>

      <div class="percentage-bar-container">
        <div class="percentage-bar" id="percentage-bar"></div>
      </div>

      <div class="breakdown">
        <span class="correct">Correct: <span id="correct-count">0</span></span>
        <span class="wrong">Wrong: <span id="wrong-count">0</span></span>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px; justify-content:center;">
        <button class="btn" id="restart-btn">Try Again</button>
        <button class="btn neutral" id="go-home">Home</button>
      </div>
    </div>
  </div>

  <!-- Admin panel -->
  <div class="admin-panel" id="admin-panel" aria-hidden="true">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:700; font-size:1.1rem;">Admin Panel</div>
      <div style="display:flex; gap:8px;">
        <button class="btn neutral" id="admin-close">Close</button>
      </div>
    </div>

    <div class="admin-tabs" role="tablist">
      <div class="admin-tab active" data-tab="questions">Questions</div>
      <div class="admin-tab" data-tab="results">Results</div>
    </div>

    <!-- Questions Tab -->
    <div class="admin-content" id="admin-questions">
      <div class="question-card">
        <div class="row"><input class="admin-input" id="new-question" placeholder="Enter question (LaTeX ok)" /></div>
        <div class="row"><input class="admin-input" id="new-opt-0" placeholder="Option A (LaTeX ok)" /></div>
        <div class="row"><input class="admin-input" id="new-opt-1" placeholder="Option B (LaTeX ok)" /></div>
        <div class="row"><input class="admin-input" id="new-opt-2" placeholder="Option C (LaTeX ok)" /></div>
        <div class="row"><input class="admin-input" id="new-opt-3" placeholder="Option D (LaTeX ok)" /></div>

        <div class="row" style="align-items:center;">
          <select id="new-answer" class="admin-input" style="width:160px;">
            <option value="">Choose correct</option>
            <option value="0">Option A</option>
            <option value="1">Option B</option>
            <option value="2">Option C</option>
            <option value="3">Option D</option>
          </select>

          <div style="flex:1"></div>

          <select id="question-count-select" class="admin-input" style="width:160px;">
            <option value="10">10 questions</option>
            <option value="15">15 questions</option>
            <option value="20">20 questions</option>
            <option value="25">25 questions</option>
            <option value="custom">Custom</option>
          </select>
          <input id="question-count-custom" class="admin-input" placeholder="Custom (max 100)" style="width:110px; display:none; margin-left:8px;" />
        </div>

        <div class="row" style="align-items:center; margin-top:8px;">
          <label class="small-muted" style="min-width:95px;">Quiz duration</label>
          <select id="duration-select" class="admin-input" style="width:160px;">
            <option value="10">10 min</option>
            <option value="15">15 min</option>
            <option value="20">20 min</option>
            <option value="25">25 min</option>
            <option value="30">30 min</option>
            <option value="45">45 min</option>
            <option value="60">60 min</option>
            <option value="custom">Custom</option>
          </select>
          <input id="duration-custom" class="admin-input" placeholder="Custom min (max 240)" style="width:110px; display:none; margin-left:8px;" />
          <div style="flex:1"></div>
          <button class="btn" id="add-question-btn">Add Question</button>
        </div>

        <div class="small-muted">Tip: Use LaTeX in inputs, e.g. <code>\frac{d}{dx} x^2</code>. Preview renders automatically below.</div>
      </div>

      <div class="question-card">
        <div style="font-weight:600;">Preview</div>
        <div id="preview-question" style="padding-top:8px;"></div>
      </div>

      <div id="admin-list" style="display:flex; flex-direction:column; gap:10px; margin-top:8px;"></div>

      <div style="display:flex; gap:8px; margin-top:8px;">
        <button class="btn" id="admin-push-firebase">Push All to Firestore</button>
        <button class="btn danger" id="admin-clear-local" style="background:#ff4d6d;">Clear Local</button>
      </div>
    </div>

    <!-- Results Tab -->
    <div class="admin-content" id="admin-results" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div class="results-controls">
          <input class="search-input" id="results-search" placeholder="Search by roll or name" />
          <button class="btn" id="btn-arrange">Arrange by Roll</button>
          <button class="btn danger" id="btn-clear-results" style="background:#ff4d6d;">Clear Results</button>
          <button class="btn" id="btn-export-csv">Export CSV</button>
        </div>
      </div>

      <table class="results-table" id="results-table">
        <thead>
          <tr><th>S.No</th><th>Roll</th><th>Name</th><th>Score</th><th>Date</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>

